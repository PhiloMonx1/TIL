## 037 [소프트웨어] 파일을 휴지통에 넣을 때 일어나는 일

---

### HDD 파일 저장 복습
HDD 파일 저장 시스템은 마치 군대와 비슷하다.
1. HDD의 용량은 HDD 플래터의 자기영역의 갯수에 의해 결정된다.
   - 즉, 500GB 용량의 HDD는 총 500,000,000,000 바이트이고, 여기에 8를 곱한 4,000,000,000,000(4조)개의 자기영역을 가지고 있는 것이다.
      - 편의상 2진법 계산이 아닌 10진법 계산을 함.
   - 이 4조 개의 자기 영역 하나를 사람 한 명에 비유해보자.
2. 4조 개의 자기 영역을 8000개씩 그룹화 해서 하나의 부대(블록)로 만든다.
3. 8000개 중 하나의 자기 영역을 부대의 대장으로 설정한다.
4. 대장의 자성 상태가 0이면 임무 수행(파일 저장)이 가능한 상태이고, 1이면 임무를 수행 중인 상태인 것이다.
5. 파일을 저장하면 대장의 상태를 1로 변경하고, 파일의 이진수를 나머지 대원들이 0과 1을 바꿔가며 표현한다. (파일의 메타데이터도 표현한다.)
6. 파일의 크기가 3000바이트라면 총 3개의 부대가 합동 작전을 해야 한다.
   - 이 때 부대는 서로 위치적으로 인접할 필요가 없다. 부대끼리 교신하기 위해 각 부대의 위치 정보가 파일의 메타데이터에 포함되어 저장된다.

### 파일 삭제 (이상)
파일 삭제는 이론적으로 완전히 반대의 일이 진행되어야 한다.
1. 삭제된 파일을 담당하는 부대를 찾는다.
2. 대장의 상태를 0으로 바꾼다.
3. 부대의 부대원들의 상태를 모두 0으로 바꾼다.

하지만 실제로는 이렇게 동작하지 않는다.

### 파일 삭제 (현실)
1. 파일을 삭제하면 '휴지통'으로 간다.
   - 휴지통은 어떤 측면에서는 특수한 폴더로 보인다. 즉, 비활성 파일을 모아둔 폴더로 생각된다.
   - 이 때는 삭제라기 보다는 휴지통이라는 특수 폴더로 파일을 옮긴 상황이다.
     - 물론 OS는 단순히 폴더를 옮기는 것과는 다르게 인식한다.
2. 휴지통 비우기를 통해 파일 삭제
   - 휴지통 폴더에 내에서도 파일의 폴더 엔트리가 삭제되고, 블록은 미사용 상태로 돌아간다. (대장의 상태가 0이 된다.)
   - 그러나 아직도 각 블록의 바이트는 그대로 남아있다. (대원이 모두 0이 되는 것이 아닌 그냥 그 상태를 유지한다.)
3. 진짜 삭제
   - 데이터가 정말 삭제되는 것은 새로운 파일을 저장할 때 이다.
   - 즉, 대장이 새로운 임무를 받고 다시 1로 복귀하고, 대원이 파일의 이진수를 표현하기 위해 분주하게 움직일 때가 기존 파일이 물리적으로 삭제되었다고 할 수 있는 상태이다.

### 장단점
- 장점 : 예상치 못한 이유로 파일을 잃어버렸을 때도 파일을 찾을 수 있다.
- 단점 : 보안상의 문제가 있을 수 있다.

### 디스크 조각 모음
HDD의 성능을 최적화하기 위해 사용되는 중요한 기능, 파일의 블록을 재정렬하여, 단편화 현상을 정리한다.
- 새 파일이 추가될 때, 운영체제는 기본적으로 파일을 순차적으로 저장한다.
  - 마치 부대가 임무를 할 때 부대 번호에 맞게 임무를 부여하는 것과 같다. (이 때 부대번호는 위치를 기반으로 정해진다. 가까운 번호는 위치상으로도 가깝다.)
- 파일이 삭제되면 중간에 빈 공간이 생긴다.
- 이 과정이 반복되면 하나의 파일을 구성하는 블록의 위치가 물리적으로 멀어지는 현상이 자주 발생한다. 
  - 이 현상을 '단편화'라고 한다.
- 파일의 메타데이터에 블록의 위치가 모두 저장된다고 해도 쪼개져 있으면 파일을 찾는 시간이 늘어난다.
  - 부대끼리 먼 거리를 교신하면서 임무를 수행해야 하기 때문에 효율성이 떨어지는 것을 생각하면 된다.
- 디스크 조각 모음을 실행하면 부대의 임무를 재설정한다. 인접한 부대끼리 같은 임무를 수행할 수 있도록 개편하는 작업을 거치는 것이다.

### 보안 삭제
데이터의 안전한 삭제를 위해 사용되는 방법으로, 단순히 파일의 메타데이터를 변경하는 것이 아니라 실제 데이터가 저장된 블록을 여러 번 덮어쓰는 과정
- 블록에 0과 1의 패턴을 여러 번 반복하여 기록함으로써 원래의 데이터를 무의미하게 만든다.
- 왜 이런 방식을 사용할까?
  - 굳이 왜 이런 번거로운 방식을 사용할까? 그냥 대장이 0으로 변할 때 나머지 대원도 전부 0으로 변경해서 초기화하면 되는 게 아닐까?
  - 이유 : 자기영역은 완벽한 디지털 스위치처럼 동작하지 않고, 연속적인 상태로 존재할 수 밖에 없기 때문에 미세한 자기 변화를 가질 수 있다.
    - 미세한 자기 변화에 의해 단순히 0으로 되돌리는 것은 기존 상태를 추측할 수 있는 가능성이 있다.
